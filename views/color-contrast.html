<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
  </head>
  <body id='dark'>
    <div class="container">
      <button id="back">Back</button>
      <div id="color-contrast-tool">
        <div id="contrastResult" style="margin-top: 1em;">      

        </div>
      </div>
    </div>
  </body>
</html>

<script type="module">


  document.getElementById('back').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'BACK' } }, '*')
  }

  window.onmessage = (event) => {
    const msg = event.data.pluginMessage;
    if (!msg || msg.type !== 'RES_CONSTRAST') return;
    const { frameColor, textColor, contrast, levels} = msg;
    const resultDiv = document.getElementById('contrastResult');
    resultDiv.innerHTML = `
      <div class="contrast-flex-row">
        <div class='sample-area' id='sample-area' style="background-color:${frameColor}">
          <p class='sample-large-text' id='sample-large-text' style="color:${textColor}">AA</p><p class='sample-small-text' id='sample-small-text'  style="color:${textColor}">aa</p>
          </div>
      </div>
      <div class="contrast-flex-row">
        
        <div style="text-align:center; width:100%">
          <input class="color-picker" type="color" id="frameColorPicker" name="colorPicker" value="${frameColor}">
          <input class="contrast-color-code" id="frameColorCode" value=${frameColor.toUpperCase()} readonly>
        </div>
         <div style="text-align:center; width:100%">
          
          <button id="swap-text-frame">
            <svg id="mySvg" width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M8 7L3 12L8 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div style="text-align:center; width:100%">
          <input class="color-picker" type="color" id="textColorPicker" name="colorPicker" value="${textColor}">
          <input class="contrast-color-code" id="textColorCode" value=${textColor.toUpperCase()} readonly>
        </div>
      </div>
      <div class="contrast-ratio">Contrast Ratio: <b>${contrast.toFixed(2)}:1</b></div>
      <div style="margin-top: 1em;">
        <table style="border-collapse: collapse;">
          <tr>
            <th></th>
            <th class='contrast-table-cell-padding'>AA</th>
            <th class='contrast-table-cell-padding'>AAA</th>
          </tr>
          <tr>
            <td class='contrast-table-row-label'>Large Text</td>
            <td style='text-align:center;'>${levels.AA_large ? '✅' : '❌'}</td>
            <td style='text-align:center;'>${levels.AAA_large ? '✅' : '❌'}</td>
          </tr>
          <tr>
            <td class='contrast-table-row-label'>Small Text</td>
            <td style='text-align:center;'>${levels.AA_small ? '✅' : '❌'}</td>
            <td style='text-align:center;'>${levels.AAA_small ? '✅' : '❌'}</td>
          </tr>
          <tr>
            <td class='contrast-table-row-label' rowspan="2">Required Ratio</td>
            <td style='text-align:center;'>3:1</td>
            <td style='text-align:center;'>4.5:1</td>
          </tr>
          <tr>
            <td style='text-align:center;'>4.5:1</td>
            <td style='text-align:center;'>7:1</td>
          </tr>
        </table>
        <div class="contrast-table-note">Large text: 18pt+ or 14pt+ bold</div>
      </div>
    `;

    // Attach event listeners after rendering
    const frameColorInput = document.getElementById('frameColorPicker');
    const textColorInput = document.getElementById('textColorPicker');
    const btnSwap = document.getElementById('swap-text-frame');

    if (frameColorInput) {
      document.getElementById('frameColorCode').innerHTML = frameColorInput.value;
      frameColorInput.onchange = (e) => {
        parent.postMessage({ pluginMessage: { type: 'CHANGE-COLOR', colorType: 'frame', value: e.target.value, textColor: textColorInput.value } }, '*');
      };
    }
    if (textColorInput) {
      document.getElementById('textColorCode').innerHTML = textColorInput.value;
      textColorInput.onchange = (e) => {
        parent.postMessage({ pluginMessage: { type: 'CHANGE-COLOR', colorType: 'text', value: e.target.value, frameColor: frameColorInput.value } }, '*');
      };
    }
    if (btnSwap) {
      btnSwap.onclick = () =>{
        const textValue = textColorInput.value;
        const frameValue = frameColorInput.value;

        const sampleArea = document.getElementById('sample-area');

        const sampleLargeText = document.getElementById('sample-large-text');
        const sampleSmallText = document.getElementById('sample-small-text');

        const textColorCode = document.getElementById('textColorCode');
        const frameColorCode = document.getElementById('frameColorCode');

        if (frameColorInput && textColorInput){
          frameColorInput.value = textValue;
          textColorInput.value = frameValue;

          sampleArea.style.backgroundColor = textValue;

          sampleLargeText.style.color = frameValue;
          sampleSmallText.style.color = frameValue;

          textColorCode.value = frameValue.toUpperCase();
          frameColorCode.value = textValue.toUpperCase();

          parent.postMessage({ pluginMessage: {type: 'SWAP', frameColor: frameColorInput.value , textColor: textColorInput.value } }, '*');
        }
      }
    }
  };

</script>

